@page
@model Organizainador.Pages.CalendarioModel
@{
    ViewData["Title"] = "Calendario";
}

<style>
    .calendar-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .calendar-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .calendar-header h1 {
        margin: 0;
        font-size: 2rem;
    }
    
    .calendar-wrapper {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    #calendar {
        max-width: 100%;
    }
    
    /* FullCalendar customization */
    .fc {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .fc .fc-button-primary {
        background-color: #667eea;
        border-color: #667eea;
    }
    
    .fc .fc-button-primary:hover {
        background-color: #764ba2;
        border-color: #764ba2;
    }
    
    .fc .fc-button-primary:not(:disabled):active,
    .fc .fc-button-primary:not(:disabled).fc-button-active {
        background-color: #764ba2;
        border-color: #764ba2;
    }
    
    .fc-event {
        cursor: pointer;
    }
    
    .fc-daygrid-day.fc-day-today {
        background-color: rgba(102, 126, 234, 0.1) !important;
    }
    
    /* Loading state */
    .loading {
        text-align: center;
        padding: 40px;
        font-size: 1.2rem;
        color: #667eea;
    }
    
    /* Responsive */
    @@media (max-width: 768px) {
        .calendar-container {
            padding: 10px;
        }
        
        .calendar-header {
            padding: 20px;
        }
        
        .calendar-header h1 {
            font-size: 1.5rem;
        }
        
        .calendar-wrapper {
            padding: 10px;
        }
    }
</style>

<div class="calendar-container">
    <div class="calendar-header">
        <h1>üìÖ Mi Calendario</h1>
        <p>Organiza tus clases y actividades</p>
    </div>
    
    <div class="calendar-wrapper">
        <div id="calendar"></div>
    </div>
</div>

@section Scripts {
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/locales/es.global.min.js'></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            
            var calendar = new FullCalendar.Calendar(calendarEl, {
                // Configuraci√≥n b√°sica
                initialView: 'dayGridMonth',
                locale: 'es',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                buttonText: {
                    today: 'Hoy',
                    month: 'Mes',
                    week: 'Semana',
                    day: 'D√≠a'
                },
                
                // Configuraci√≥n de visualizaci√≥n
                height: 'auto',
                nowIndicator: true,
                navLinks: true,
                
                // Cargar eventos
                events: function(info, successCallback, failureCallback) {
                    fetch('/Calendario?handler=GetEvents')
                        .then(response => response.json())
                        .then(data => {
                            console.log('Eventos cargados:', data);
                            successCallback(data);
                        })
                        .catch(error => {
                            console.error('Error al cargar eventos:', error);
                            failureCallback(error);
                        });
                },
                
                // Click en evento
                eventClick: function(info) {
                    var eventType = info.event.extendedProps.eventType;
                    var message = 'üìå ' + info.event.title + '\n\n';
                    message += 'üïê ' + info.event.start.toLocaleString('es-ES') + '\n';
                    
                    if (info.event.extendedProps.description) {
                        message += '\nüìù ' + info.event.extendedProps.description;
                    }
                    
                    if (confirm(message + '\n\n¬øDeseas editar este evento?')) {
                        if (eventType === 'Actividad') {
                            window.location.href = '/Actividades/Edit/' + info.event.id;
                        } else if (eventType === 'Clase') {
                            window.location.href = '/Horarios/Edit/' + info.event.id;
                        }
                    }
                },
                
                // Colores de eventos
                eventDidMount: function(info) {
                    if (info.event.extendedProps.eventType === 'Clase') {
                        info.el.style.backgroundColor = '#0d6efd';
                        info.el.style.borderColor = '#0d6efd';
                    } else if (info.event.extendedProps.eventType === 'Actividad') {
                        info.el.style.backgroundColor = '#dc3545';
                        info.el.style.borderColor = '#dc3545';
                    }
                }
            });
            
            calendar.render();
            console.log('‚úÖ Calendario inicializado correctamente');
        });
    </script>
}
